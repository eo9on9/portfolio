import { Item, Product } from '@server/types'
import { NextApiRequest, NextApiResponse } from 'next'

export const ITEM_DATABASE: Record<string, Item> = {
  wooden_sword: {
    name: '나무 검',
    category: 'weapon',
    image_src: '/images/wooden-sword.png',
    grade: 'normal',
    description: '나무로 만들어진 검. (공격력 +10)',
  },
  stone_sword: {
    name: '돌 검',
    category: 'weapon',
    image_src: '/images/stone-sword.png',
    grade: 'normal',
    description: '돌로 만들어진 검. (공격력 +12)',
  },
  steel_sword: {
    name: '강철 검',
    category: 'weapon',
    image_src: '/images/steel-sword.png',
    grade: 'rare',
    description: '강철로 만들어진 검. (공격력 +14)',
  },
  demon_sword: {
    name: '악마의 검',
    category: 'weapon',
    image_src: '/images/demon-sword.png',
    grade: 'epic',
    description: '악마의 힘을 담은 검. (공격력 +20)',
  },
  dragon_sword: {
    name: '용의 검',
    category: 'weapon',
    image_src: '/images/dragon-sword.png',
    grade: 'legendary',
    description: '용의 힘을 담은 검. (공격력 +24)',
  },
  cloth_armor: {
    name: '천 갑옷',
    category: 'armor',
    image_src: '/images/cloth-armor.png',
    grade: 'normal',
    description: '천으로 만들어진 갑옷. (방어력 +10)',
  },
  leather_armor: {
    name: '가죽 갑옷',
    category: 'armor',
    image_src: '/images/leather-armor.png',
    grade: 'normal',
    description: '가죽으로 만들어진 갑옷. (방어력 +12)',
  },
  metal_armor: {
    name: '금속 갑옷',
    category: 'armor',
    image_src: '/images/metal-armor.png',
    grade: 'rare',
    description: '금속으로 만들어진 갑옷. (방어력 +14)',
  },
  dragon_armor: {
    name: '용 갑옷',
    category: 'armor',
    image_src: '/images/dragon-armor.png',
    grade: 'epic',
    description: '용의 힘을 담은 갑옷. (방어력 +16)',
  },
  hp_potion: {
    name: 'HP 포션',
    category: 'consumable',
    image_src: '/images/hp-potion.png',
    grade: 'normal',
    description: 'HP를 회복하는 포션. (HP +100)',
  },
  mp_potion: {
    name: 'MP 포션',
    category: 'consumable',
    image_src: '/images/mp-potion.png',
    grade: 'normal',
    description: 'MP를 회복하는 포션. (MP +100)',
  },
  ring: {
    name: '반지',
    category: 'accessory',
    image_src: '/images/ring.png',
    grade: 'normal',
    description: '반지. (속성 +10)',
  },
  crown: {
    name: '왕관',
    category: 'accessory',
    image_src: '/images/crown.png',
    grade: 'rare',
    description: '왕관. (속성 +12)',
  },
  ore: {
    name: '광석',
    category: 'material',
    image_src: '/images/ore.png',
    grade: 'normal',
    description: '광석. (속성 +10)',
  },
  scroll: {
    name: '스크롤',
    category: 'material',
    image_src: '/images/scroll.png',
    grade: 'normal',
    description: '문서. (속성 +10)',
  },
}

interface FilterParams {
  name?: string
  category?: string
  grade?: string
  type?: string
}

const MOCK_PRODUCTS: Product[] = [
  {
    id: '185',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '대장장이토르',
    price: 3869220,
    amount: 27,
    created_at: 1763950261957,
  },
  {
    id: '184',
    item_key: 'dragon_armor',
    type: 'sell',
    listed_by: '서리마녀',
    price: 673310,
    amount: 21,
    created_at: 1763950081957,
  },
  {
    id: '183',
    item_key: 'metal_armor',
    type: 'sell',
    listed_by: '슬라임킬러',
    price: 94413,
    amount: 26,
    created_at: 1763949901957,
  },
  {
    id: '182',
    item_key: 'ore',
    type: 'sell',
    listed_by: '용맹한방랑자',
    price: 11263,
    amount: 1,
    created_at: 1763949721957,
  },
  {
    id: '181',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '대장장이토르',
    price: 411044,
    amount: 44,
    created_at: 1763949541957,
  },
  {
    id: '180',
    item_key: 'steel_sword',
    type: 'sell',
    listed_by: '몬스터헌터',
    price: 840,
    amount: 35,
    created_at: 1763949361957,
  },
  {
    id: '179',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '대장장이토르',
    price: 251,
    amount: 11,
    created_at: 1763949181957,
  },
  {
    id: '178',
    item_key: 'mp_potion',
    type: 'buy',
    listed_by: '몬스터헌터',
    price: 72159,
    amount: 50,
    created_at: 1763949001957,
  },
  {
    id: '177',
    item_key: 'wooden_sword',
    type: 'buy',
    listed_by: '서리마녀',
    price: 167919,
    amount: 4,
    created_at: 1763948821957,
  },
  {
    id: '176',
    item_key: 'demon_sword',
    type: 'buy',
    listed_by: '슬라임킬러',
    price: 253,
    amount: 41,
    created_at: 1763948641957,
  },
  {
    id: '175',
    item_key: 'scroll',
    type: 'sell',
    listed_by: '모험왕',
    price: 40492,
    amount: 35,
    created_at: 1763948461957,
  },
  {
    id: '174',
    item_key: 'mp_potion',
    type: 'sell',
    listed_by: '용맹한방랑자',
    price: 724,
    amount: 15,
    created_at: 1763948281957,
  },
  {
    id: '173',
    item_key: 'hp_potion',
    type: 'buy',
    listed_by: '대장장이토르',
    price: 4861927,
    amount: 39,
    created_at: 1763948101957,
  },
  {
    id: '172',
    item_key: 'leather_armor',
    type: 'sell',
    listed_by: '용맹한방랑자',
    price: 9327,
    amount: 43,
    created_at: 1763947921957,
  },
  {
    id: '171',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '만렙전사',
    price: 258483,
    amount: 11,
    created_at: 1763947741957,
  },
  {
    id: '170',
    item_key: 'stone_sword',
    type: 'sell',
    listed_by: '빛의기사',
    price: 3230894,
    amount: 25,
    created_at: 1763947561957,
  },
  {
    id: '169',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '만렙전사',
    price: 936911,
    amount: 13,
    created_at: 1763947381957,
  },
  {
    id: '168',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '어둠의추적자',
    price: 861244,
    amount: 19,
    created_at: 1763947201957,
  },
  {
    id: '167',
    item_key: 'metal_armor',
    type: 'buy',
    listed_by: '마법학도',
    price: 234990,
    amount: 9,
    created_at: 1763947021957,
  },
  {
    id: '166',
    item_key: 'scroll',
    type: 'sell',
    listed_by: '모험왕',
    price: 869690,
    amount: 12,
    created_at: 1763946841957,
  },
  {
    id: '165',
    item_key: 'ore',
    type: 'buy',
    listed_by: '서리마녀',
    price: 7914,
    amount: 47,
    created_at: 1763946661957,
  },
  {
    id: '164',
    item_key: 'mp_potion',
    type: 'sell',
    listed_by: '모험왕',
    price: 243,
    amount: 34,
    created_at: 1763946481957,
  },
  {
    id: '163',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 1230835,
    amount: 9,
    created_at: 1763946301957,
  },
  {
    id: '162',
    item_key: 'cloth_armor',
    type: 'sell',
    listed_by: '드래곤슬레이어',
    price: 472847,
    amount: 17,
    created_at: 1763946121957,
  },
  {
    id: '161',
    item_key: 'mp_potion',
    type: 'sell',
    listed_by: '방패장인',
    price: 749,
    amount: 17,
    created_at: 1763945941957,
  },
  {
    id: '160',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '모험왕',
    price: 6409,
    amount: 40,
    created_at: 1763945761957,
  },
  {
    id: '159',
    item_key: 'crown',
    type: 'sell',
    listed_by: '약초채집가',
    price: 3711441,
    amount: 31,
    created_at: 1763945581957,
  },
  {
    id: '158',
    item_key: 'hp_potion',
    type: 'sell',
    listed_by: '만렙전사',
    price: 2157,
    amount: 20,
    created_at: 1763945401957,
  },
  {
    id: '157',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '포션중독자',
    price: 5155,
    amount: 33,
    created_at: 1763945221957,
  },
  {
    id: '156',
    item_key: 'cloth_armor',
    type: 'sell',
    listed_by: '만렙전사',
    price: 439,
    amount: 42,
    created_at: 1763945041957,
  },
  {
    id: '155',
    item_key: 'dragon_armor',
    type: 'buy',
    listed_by: '골드사냥꾼',
    price: 338288,
    amount: 15,
    created_at: 1763944861957,
  },
  {
    id: '154',
    item_key: 'dragon_armor',
    type: 'buy',
    listed_by: '대장장이토르',
    price: 378338,
    amount: 4,
    created_at: 1763944681957,
  },
  {
    id: '153',
    item_key: 'metal_armor',
    type: 'buy',
    listed_by: '골드사냥꾼',
    price: 9797,
    amount: 28,
    created_at: 1763944501957,
  },
  {
    id: '152',
    item_key: 'demon_sword',
    type: 'sell',
    listed_by: '몬스터헌터',
    price: 2285862,
    amount: 27,
    created_at: 1763944321957,
  },
  {
    id: '151',
    item_key: 'dragon_armor',
    type: 'sell',
    listed_by: '슬라임킬러',
    price: 967,
    amount: 20,
    created_at: 1763944141957,
  },
  {
    id: '150',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '어둠의추적자',
    price: 4380483,
    amount: 41,
    created_at: 1763943961957,
  },
  {
    id: '149',
    item_key: 'dragon_armor',
    type: 'sell',
    listed_by: '마법학도',
    price: 46188,
    amount: 38,
    created_at: 1763943781957,
  },
  {
    id: '148',
    item_key: 'ore',
    type: 'buy',
    listed_by: '골드사냥꾼',
    price: 334152,
    amount: 23,
    created_at: 1763943601957,
  },
  {
    id: '147',
    item_key: 'cloth_armor',
    type: 'buy',
    listed_by: '몬스터헌터',
    price: 225,
    amount: 10,
    created_at: 1763943421957,
  },
  {
    id: '146',
    item_key: 'crown',
    type: 'buy',
    listed_by: '광산의요정',
    price: 591,
    amount: 48,
    created_at: 1763943241957,
  },
  {
    id: '145',
    item_key: 'mp_potion',
    type: 'buy',
    listed_by: '방패장인',
    price: 4616,
    amount: 7,
    created_at: 1763943061957,
  },
  {
    id: '144',
    item_key: 'wooden_sword',
    type: 'buy',
    listed_by: '광산의요정',
    price: 800135,
    amount: 10,
    created_at: 1763942881957,
  },
  {
    id: '143',
    item_key: 'stone_sword',
    type: 'sell',
    listed_by: '검수집가',
    price: 116,
    amount: 30,
    created_at: 1763942701957,
  },
  {
    id: '142',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '빛의기사',
    price: 232,
    amount: 15,
    created_at: 1763942521957,
  },
  {
    id: '141',
    item_key: 'mp_potion',
    type: 'sell',
    listed_by: '몬스터헌터',
    price: 400762,
    amount: 25,
    created_at: 1763942341957,
  },
  {
    id: '140',
    item_key: 'wooden_sword',
    type: 'sell',
    listed_by: '빛의기사',
    price: 576,
    amount: 6,
    created_at: 1763942161957,
  },
  {
    id: '139',
    item_key: 'stone_sword',
    type: 'sell',
    listed_by: '빛의기사',
    price: 62150,
    amount: 44,
    created_at: 1763941981957,
  },
  {
    id: '138',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '마법학도',
    price: 480,
    amount: 4,
    created_at: 1763941801957,
  },
  {
    id: '137',
    item_key: 'cloth_armor',
    type: 'sell',
    listed_by: '약초채집가',
    price: 1941393,
    amount: 19,
    created_at: 1763941621957,
  },
  {
    id: '136',
    item_key: 'metal_armor',
    type: 'sell',
    listed_by: '빠른발도술',
    price: 5719,
    amount: 12,
    created_at: 1763941441957,
  },
  {
    id: '135',
    item_key: 'wooden_sword',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 89677,
    amount: 27,
    created_at: 1763941261957,
  },
  {
    id: '134',
    item_key: 'cloth_armor',
    type: 'buy',
    listed_by: '슬라임킬러',
    price: 76853,
    amount: 18,
    created_at: 1763941081957,
  },
  {
    id: '133',
    item_key: 'stone_sword',
    type: 'sell',
    listed_by: '대장장이토르',
    price: 90637,
    amount: 12,
    created_at: 1763940901957,
  },
  {
    id: '132',
    item_key: 'wooden_sword',
    type: 'buy',
    listed_by: '용맹한방랑자',
    price: 530625,
    amount: 2,
    created_at: 1763940721957,
  },
  {
    id: '131',
    item_key: 'ore',
    type: 'buy',
    listed_by: '방패장인',
    price: 306261,
    amount: 10,
    created_at: 1763940541957,
  },
  {
    id: '130',
    item_key: 'mp_potion',
    type: 'sell',
    listed_by: '방패장인',
    price: 98977,
    amount: 41,
    created_at: 1763940361957,
  },
  {
    id: '129',
    item_key: 'scroll',
    type: 'sell',
    listed_by: '빛의기사',
    price: 82739,
    amount: 27,
    created_at: 1763940181957,
  },
  {
    id: '128',
    item_key: 'dragon_armor',
    type: 'buy',
    listed_by: '포션중독자',
    price: 805,
    amount: 1,
    created_at: 1763940001957,
  },
  {
    id: '127',
    item_key: 'mp_potion',
    type: 'buy',
    listed_by: '몬스터헌터',
    price: 8919,
    amount: 11,
    created_at: 1763939821957,
  },
  {
    id: '126',
    item_key: 'demon_sword',
    type: 'sell',
    listed_by: '골드사냥꾼',
    price: 750,
    amount: 45,
    created_at: 1763939641957,
  },
  {
    id: '125',
    item_key: 'ore',
    type: 'buy',
    listed_by: '방패장인',
    price: 4073,
    amount: 38,
    created_at: 1763939461957,
  },
  {
    id: '124',
    item_key: 'wooden_sword',
    type: 'sell',
    listed_by: '칼끝장전',
    price: 1323,
    amount: 29,
    created_at: 1763939281957,
  },
  {
    id: '123',
    item_key: 'crown',
    type: 'buy',
    listed_by: '만렙전사',
    price: 2743763,
    amount: 31,
    created_at: 1763939101957,
  },
  {
    id: '122',
    item_key: 'cloth_armor',
    type: 'sell',
    listed_by: '몬스터헌터',
    price: 1102102,
    amount: 13,
    created_at: 1763938921957,
  },
  {
    id: '121',
    item_key: 'stone_sword',
    type: 'buy',
    listed_by: '슬라임킬러',
    price: 45384,
    amount: 2,
    created_at: 1763938741957,
  },
  {
    id: '120',
    item_key: 'ring',
    type: 'sell',
    listed_by: '칼끝장전',
    price: 6401,
    amount: 20,
    created_at: 1763938561957,
  },
  {
    id: '119',
    item_key: 'steel_sword',
    type: 'sell',
    listed_by: '포션중독자',
    price: 86226,
    amount: 25,
    created_at: 1763938381957,
  },
  {
    id: '118',
    item_key: 'ore',
    type: 'buy',
    listed_by: '빠른발도술',
    price: 1388276,
    amount: 50,
    created_at: 1763938201957,
  },
  {
    id: '117',
    item_key: 'wooden_sword',
    type: 'sell',
    listed_by: '만렙전사',
    price: 514,
    amount: 30,
    created_at: 1763938021957,
  },
  {
    id: '116',
    item_key: 'leather_armor',
    type: 'sell',
    listed_by: '대장장이토르',
    price: 64804,
    amount: 26,
    created_at: 1763937841957,
  },
  {
    id: '115',
    item_key: 'cloth_armor',
    type: 'buy',
    listed_by: '빛의기사',
    price: 77748,
    amount: 6,
    created_at: 1763937661957,
  },
  {
    id: '114',
    item_key: 'mp_potion',
    type: 'sell',
    listed_by: '용맹한방랑자',
    price: 1886242,
    amount: 31,
    created_at: 1763937481957,
  },
  {
    id: '113',
    item_key: 'wooden_sword',
    type: 'sell',
    listed_by: '방패장인',
    price: 436,
    amount: 49,
    created_at: 1763937301957,
  },
  {
    id: '112',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '빛의기사',
    price: 551346,
    amount: 16,
    created_at: 1763937121957,
  },
  {
    id: '111',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '모험왕',
    price: 1765074,
    amount: 34,
    created_at: 1763936941957,
  },
  {
    id: '110',
    item_key: 'cloth_armor',
    type: 'buy',
    listed_by: '어둠의추적자',
    price: 111,
    amount: 7,
    created_at: 1763936761957,
  },
  {
    id: '109',
    item_key: 'ring',
    type: 'buy',
    listed_by: '광산의요정',
    price: 208054,
    amount: 43,
    created_at: 1763936581957,
  },
  {
    id: '108',
    item_key: 'dragon_armor',
    type: 'buy',
    listed_by: '서리마녀',
    price: 147,
    amount: 10,
    created_at: 1763936401957,
  },
  {
    id: '107',
    item_key: 'wooden_sword',
    type: 'buy',
    listed_by: '광산의요정',
    price: 19371,
    amount: 42,
    created_at: 1763936221957,
  },
  {
    id: '106',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '검수집가',
    price: 855814,
    amount: 35,
    created_at: 1763936041957,
  },
  {
    id: '105',
    item_key: 'steel_sword',
    type: 'sell',
    listed_by: '드래곤슬레이어',
    price: 120604,
    amount: 27,
    created_at: 1763935861957,
  },
  {
    id: '104',
    item_key: 'dragon_armor',
    type: 'sell',
    listed_by: '약초채집가',
    price: 770458,
    amount: 38,
    created_at: 1763935681957,
  },
  {
    id: '103',
    item_key: 'steel_sword',
    type: 'sell',
    listed_by: '방패장인',
    price: 106028,
    amount: 3,
    created_at: 1763935501957,
  },
  {
    id: '102',
    item_key: 'leather_armor',
    type: 'buy',
    listed_by: '골드사냥꾼',
    price: 90875,
    amount: 3,
    created_at: 1763935321957,
  },
  {
    id: '101',
    item_key: 'dragon_armor',
    type: 'buy',
    listed_by: '마법학도',
    price: 576,
    amount: 4,
    created_at: 1763935141957,
  },
  {
    id: '100',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '어둠의추적자',
    price: 569,
    amount: 16,
    created_at: 1763934961957,
  },
  {
    id: '99',
    item_key: 'hp_potion',
    type: 'buy',
    listed_by: '몬스터헌터',
    price: 592,
    amount: 44,
    created_at: 1763934781957,
  },
  {
    id: '98',
    item_key: 'leather_armor',
    type: 'sell',
    listed_by: '드래곤슬레이어',
    price: 18679,
    amount: 43,
    created_at: 1763934601957,
  },
  {
    id: '97',
    item_key: 'ring',
    type: 'buy',
    listed_by: '서리마녀',
    price: 40353,
    amount: 20,
    created_at: 1763934421957,
  },
  {
    id: '96',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '포션중독자',
    price: 1512355,
    amount: 35,
    created_at: 1763934241957,
  },
  {
    id: '95',
    item_key: 'demon_sword',
    type: 'sell',
    listed_by: '약초채집가',
    price: 3187755,
    amount: 25,
    created_at: 1763934061957,
  },
  {
    id: '94',
    item_key: 'wooden_sword',
    type: 'sell',
    listed_by: '비밀결사단',
    price: 74557,
    amount: 9,
    created_at: 1763933881957,
  },
  {
    id: '93',
    item_key: 'hp_potion',
    type: 'buy',
    listed_by: '어둠의추적자',
    price: 261098,
    amount: 6,
    created_at: 1763933701957,
  },
  {
    id: '92',
    item_key: 'crown',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 715,
    amount: 32,
    created_at: 1763933521957,
  },
  {
    id: '91',
    item_key: 'wooden_sword',
    type: 'sell',
    listed_by: '비밀결사단',
    price: 816,
    amount: 46,
    created_at: 1763933341957,
  },
  {
    id: '90',
    item_key: 'dragon_armor',
    type: 'sell',
    listed_by: '만렙전사',
    price: 59902,
    amount: 27,
    created_at: 1763933161957,
  },
  {
    id: '89',
    item_key: 'leather_armor',
    type: 'sell',
    listed_by: '만렙전사',
    price: 90186,
    amount: 11,
    created_at: 1763932981957,
  },
  {
    id: '88',
    item_key: 'demon_sword',
    type: 'buy',
    listed_by: '빠른발도술',
    price: 454,
    amount: 11,
    created_at: 1763932801957,
  },
  {
    id: '87',
    item_key: 'crown',
    type: 'buy',
    listed_by: '광산의요정',
    price: 68309,
    amount: 5,
    created_at: 1763932621957,
  },
  {
    id: '86',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '어둠의추적자',
    price: 218,
    amount: 42,
    created_at: 1763932441957,
  },
  {
    id: '85',
    item_key: 'cloth_armor',
    type: 'buy',
    listed_by: '빛의기사',
    price: 147,
    amount: 45,
    created_at: 1763932261957,
  },
  {
    id: '84',
    item_key: 'ore',
    type: 'sell',
    listed_by: '검수집가',
    price: 2863537,
    amount: 22,
    created_at: 1763932081957,
  },
  {
    id: '83',
    item_key: 'crown',
    type: 'buy',
    listed_by: '빛의기사',
    price: 921,
    amount: 9,
    created_at: 1763931901957,
  },
  {
    id: '82',
    item_key: 'scroll',
    type: 'sell',
    listed_by: '어둠의추적자',
    price: 523,
    amount: 6,
    created_at: 1763931721957,
  },
  {
    id: '81',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '마법학도',
    price: 6359,
    amount: 18,
    created_at: 1763931541957,
  },
  {
    id: '80',
    item_key: 'metal_armor',
    type: 'buy',
    listed_by: '약초채집가',
    price: 2540360,
    amount: 48,
    created_at: 1763931361957,
  },
  {
    id: '79',
    item_key: 'ore',
    type: 'sell',
    listed_by: '몬스터헌터',
    price: 486,
    amount: 11,
    created_at: 1763931181957,
  },
  {
    id: '78',
    item_key: 'ore',
    type: 'sell',
    listed_by: '마법학도',
    price: 556711,
    amount: 26,
    created_at: 1763931001957,
  },
  {
    id: '77',
    item_key: 'cloth_armor',
    type: 'sell',
    listed_by: '빛의기사',
    price: 1204959,
    amount: 34,
    created_at: 1763930821957,
  },
  {
    id: '76',
    item_key: 'stone_sword',
    type: 'sell',
    listed_by: '포션중독자',
    price: 949991,
    amount: 23,
    created_at: 1763930641957,
  },
  {
    id: '75',
    item_key: 'metal_armor',
    type: 'buy',
    listed_by: '포션중독자',
    price: 863,
    amount: 41,
    created_at: 1763930461957,
  },
  {
    id: '74',
    item_key: 'leather_armor',
    type: 'buy',
    listed_by: '만렙전사',
    price: 8392,
    amount: 49,
    created_at: 1763930281957,
  },
  {
    id: '73',
    item_key: 'ring',
    type: 'sell',
    listed_by: '광산의요정',
    price: 825024,
    amount: 34,
    created_at: 1763930101957,
  },
  {
    id: '72',
    item_key: 'stone_sword',
    type: 'sell',
    listed_by: '만렙전사',
    price: 900281,
    amount: 10,
    created_at: 1763929921957,
  },
  {
    id: '71',
    item_key: 'hp_potion',
    type: 'sell',
    listed_by: '몬스터헌터',
    price: 1401,
    amount: 37,
    created_at: 1763929741957,
  },
  {
    id: '70',
    item_key: 'metal_armor',
    type: 'sell',
    listed_by: '빠른발도술',
    price: 41005,
    amount: 24,
    created_at: 1763929561957,
  },
  {
    id: '69',
    item_key: 'ore',
    type: 'sell',
    listed_by: '몬스터헌터',
    price: 543,
    amount: 17,
    created_at: 1763929381957,
  },
  {
    id: '68',
    item_key: 'cloth_armor',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 5362,
    amount: 45,
    created_at: 1763929201957,
  },
  {
    id: '67',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '칼끝장전',
    price: 1395,
    amount: 32,
    created_at: 1763929021957,
  },
  {
    id: '66',
    item_key: 'ring',
    type: 'sell',
    listed_by: '어둠의추적자',
    price: 546,
    amount: 4,
    created_at: 1763928841957,
  },
  {
    id: '65',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '서리마녀',
    price: 746851,
    amount: 23,
    created_at: 1763928661957,
  },
  {
    id: '64',
    item_key: 'hp_potion',
    type: 'buy',
    listed_by: '광산의요정',
    price: 4291407,
    amount: 22,
    created_at: 1763928481957,
  },
  {
    id: '63',
    item_key: 'cloth_armor',
    type: 'sell',
    listed_by: '빛의기사',
    price: 9377,
    amount: 20,
    created_at: 1763928301957,
  },
  {
    id: '62',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '비밀결사단',
    price: 3189625,
    amount: 36,
    created_at: 1763928121957,
  },
  {
    id: '61',
    item_key: 'dragon_armor',
    type: 'sell',
    listed_by: '포션중독자',
    price: 86505,
    amount: 7,
    created_at: 1763927941957,
  },
  {
    id: '60',
    item_key: 'wooden_sword',
    type: 'sell',
    listed_by: '용맹한방랑자',
    price: 679,
    amount: 31,
    created_at: 1763927761957,
  },
  {
    id: '59',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '약초채집가',
    price: 5115,
    amount: 7,
    created_at: 1763927581957,
  },
  {
    id: '58',
    item_key: 'cloth_armor',
    type: 'buy',
    listed_by: '만렙전사',
    price: 2081,
    amount: 15,
    created_at: 1763927401957,
  },
  {
    id: '57',
    item_key: 'scroll',
    type: 'sell',
    listed_by: '마법학도',
    price: 552,
    amount: 43,
    created_at: 1763927221957,
  },
  {
    id: '56',
    item_key: 'ring',
    type: 'buy',
    listed_by: '칼끝장전',
    price: 3699865,
    amount: 5,
    created_at: 1763927041957,
  },
  {
    id: '55',
    item_key: 'metal_armor',
    type: 'buy',
    listed_by: '방패장인',
    price: 4679,
    amount: 50,
    created_at: 1763926861957,
  },
  {
    id: '54',
    item_key: 'crown',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 30374,
    amount: 30,
    created_at: 1763926681957,
  },
  {
    id: '53',
    item_key: 'metal_armor',
    type: 'sell',
    listed_by: '방패장인',
    price: 79677,
    amount: 20,
    created_at: 1763926501957,
  },
  {
    id: '52',
    item_key: 'metal_armor',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 3386498,
    amount: 28,
    created_at: 1763926321957,
  },
  {
    id: '51',
    item_key: 'metal_armor',
    type: 'sell',
    listed_by: '어둠의추적자',
    price: 1765229,
    amount: 14,
    created_at: 1763926141957,
  },
  {
    id: '50',
    item_key: 'ore',
    type: 'sell',
    listed_by: '빠른발도술',
    price: 4928509,
    amount: 47,
    created_at: 1763925961957,
  },
  {
    id: '49',
    item_key: 'dragon_armor',
    type: 'buy',
    listed_by: '빠른발도술',
    price: 373051,
    amount: 30,
    created_at: 1763925781957,
  },
  {
    id: '48',
    item_key: 'stone_sword',
    type: 'buy',
    listed_by: '검수집가',
    price: 259,
    amount: 27,
    created_at: 1763925601957,
  },
  {
    id: '47',
    item_key: 'mp_potion',
    type: 'buy',
    listed_by: '서리마녀',
    price: 72996,
    amount: 1,
    created_at: 1763925421957,
  },
  {
    id: '46',
    item_key: 'demon_sword',
    type: 'sell',
    listed_by: '만렙전사',
    price: 8059,
    amount: 43,
    created_at: 1763925241957,
  },
  {
    id: '45',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '광산의요정',
    price: 485449,
    amount: 19,
    created_at: 1763925061957,
  },
  {
    id: '44',
    item_key: 'dragon_sword',
    type: 'sell',
    listed_by: '드래곤슬레이어',
    price: 248,
    amount: 37,
    created_at: 1763924881957,
  },
  {
    id: '43',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '어둠의추적자',
    price: 836,
    amount: 6,
    created_at: 1763924701957,
  },
  {
    id: '42',
    item_key: 'ring',
    type: 'sell',
    listed_by: '모험왕',
    price: 760672,
    amount: 16,
    created_at: 1763924521957,
  },
  {
    id: '41',
    item_key: 'leather_armor',
    type: 'buy',
    listed_by: '방패장인',
    price: 38769,
    amount: 38,
    created_at: 1763924341957,
  },
  {
    id: '40',
    item_key: 'scroll',
    type: 'sell',
    listed_by: '빛의기사',
    price: 651077,
    amount: 9,
    created_at: 1763924161957,
  },
  {
    id: '39',
    item_key: 'hp_potion',
    type: 'buy',
    listed_by: '빛의기사',
    price: 145294,
    amount: 28,
    created_at: 1763923981957,
  },
  {
    id: '38',
    item_key: 'dragon_armor',
    type: 'sell',
    listed_by: '서리마녀',
    price: 9467,
    amount: 41,
    created_at: 1763923801957,
  },
  {
    id: '37',
    item_key: 'ore',
    type: 'buy',
    listed_by: '약초채집가',
    price: 3157,
    amount: 1,
    created_at: 1763923621957,
  },
  {
    id: '36',
    item_key: 'steel_sword',
    type: 'buy',
    listed_by: '서리마녀',
    price: 408274,
    amount: 41,
    created_at: 1763923441957,
  },
  {
    id: '35',
    item_key: 'metal_armor',
    type: 'sell',
    listed_by: '슬라임킬러',
    price: 2559268,
    amount: 26,
    created_at: 1763923261957,
  },
  {
    id: '34',
    item_key: 'ore',
    type: 'buy',
    listed_by: '용맹한방랑자',
    price: 478,
    amount: 39,
    created_at: 1763923081957,
  },
  {
    id: '33',
    item_key: 'crown',
    type: 'sell',
    listed_by: '검수집가',
    price: 841035,
    amount: 14,
    created_at: 1763922901957,
  },
  {
    id: '32',
    item_key: 'scroll',
    type: 'sell',
    listed_by: '빛의기사',
    price: 561,
    amount: 44,
    created_at: 1763922721957,
  },
  {
    id: '31',
    item_key: 'ring',
    type: 'buy',
    listed_by: '용맹한방랑자',
    price: 3332198,
    amount: 28,
    created_at: 1763922541957,
  },
  {
    id: '30',
    item_key: 'mp_potion',
    type: 'sell',
    listed_by: '서리마녀',
    price: 906,
    amount: 24,
    created_at: 1763922361957,
  },
  {
    id: '29',
    item_key: 'hp_potion',
    type: 'sell',
    listed_by: '모험왕',
    price: 294,
    amount: 2,
    created_at: 1763922181957,
  },
  {
    id: '28',
    item_key: 'dragon_armor',
    type: 'sell',
    listed_by: '포션중독자',
    price: 7324,
    amount: 4,
    created_at: 1763922001957,
  },
  {
    id: '27',
    item_key: 'leather_armor',
    type: 'sell',
    listed_by: '검수집가',
    price: 3574173,
    amount: 24,
    created_at: 1763921821957,
  },
  {
    id: '26',
    item_key: 'wooden_sword',
    type: 'sell',
    listed_by: '모험왕',
    price: 1390711,
    amount: 27,
    created_at: 1763921641957,
  },
  {
    id: '25',
    item_key: 'ring',
    type: 'buy',
    listed_by: '어둠의추적자',
    price: 519,
    amount: 19,
    created_at: 1763921461957,
  },
  {
    id: '24',
    item_key: 'steel_sword',
    type: 'sell',
    listed_by: '빛의기사',
    price: 935972,
    amount: 46,
    created_at: 1763921281957,
  },
  {
    id: '23',
    item_key: 'hp_potion',
    type: 'buy',
    listed_by: '만렙전사',
    price: 216756,
    amount: 20,
    created_at: 1763921101957,
  },
  {
    id: '22',
    item_key: 'demon_sword',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 97120,
    amount: 18,
    created_at: 1763920921957,
  },
  {
    id: '21',
    item_key: 'mp_potion',
    type: 'buy',
    listed_by: '광산의요정',
    price: 31288,
    amount: 7,
    created_at: 1763920741957,
  },
  {
    id: '20',
    item_key: 'ore',
    type: 'buy',
    listed_by: '검수집가',
    price: 2939356,
    amount: 14,
    created_at: 1763920561957,
  },
  {
    id: '19',
    item_key: 'dragon_sword',
    type: 'sell',
    listed_by: '어둠의추적자',
    price: 6094,
    amount: 24,
    created_at: 1763920381957,
  },
  {
    id: '18',
    item_key: 'dragon_sword',
    type: 'sell',
    listed_by: '빛의기사',
    price: 51958,
    amount: 40,
    created_at: 1763920201957,
  },
  {
    id: '17',
    item_key: 'steel_sword',
    type: 'sell',
    listed_by: '빠른발도술',
    price: 3190541,
    amount: 3,
    created_at: 1763920021957,
  },
  {
    id: '16',
    item_key: 'demon_sword',
    type: 'buy',
    listed_by: '마법학도',
    price: 954,
    amount: 37,
    created_at: 1763919841957,
  },
  {
    id: '15',
    item_key: 'dragon_sword',
    type: 'buy',
    listed_by: '서리마녀',
    price: 222266,
    amount: 30,
    created_at: 1763919661957,
  },
  {
    id: '14',
    item_key: 'stone_sword',
    type: 'sell',
    listed_by: '광산의요정',
    price: 7455,
    amount: 15,
    created_at: 1763919481957,
  },
  {
    id: '13',
    item_key: 'leather_armor',
    type: 'sell',
    listed_by: '만렙전사',
    price: 18532,
    amount: 26,
    created_at: 1763919301957,
  },
  {
    id: '12',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '서리마녀',
    price: 4806139,
    amount: 18,
    created_at: 1763919121957,
  },
  {
    id: '11',
    item_key: 'ring',
    type: 'sell',
    listed_by: '어둠의추적자',
    price: 1508937,
    amount: 27,
    created_at: 1763918941957,
  },
  {
    id: '10',
    item_key: 'demon_sword',
    type: 'buy',
    listed_by: '빛의기사',
    price: 79257,
    amount: 34,
    created_at: 1763918761957,
  },
  {
    id: '9',
    item_key: 'mp_potion',
    type: 'buy',
    listed_by: '약초채집가',
    price: 3565400,
    amount: 16,
    created_at: 1763918581957,
  },
  {
    id: '8',
    item_key: 'hp_potion',
    type: 'sell',
    listed_by: '방패장인',
    price: 920,
    amount: 29,
    created_at: 1763918401957,
  },
  {
    id: '7',
    item_key: 'hp_potion',
    type: 'buy',
    listed_by: '광산의요정',
    price: 1209552,
    amount: 42,
    created_at: 1763918221957,
  },
  {
    id: '6',
    item_key: 'leather_armor',
    type: 'buy',
    listed_by: '몬스터헌터',
    price: 163,
    amount: 8,
    created_at: 1763918041957,
  },
  {
    id: '5',
    item_key: 'scroll',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 429,
    amount: 31,
    created_at: 1763917861957,
  },
  {
    id: '4',
    item_key: 'ore',
    type: 'buy',
    listed_by: '드래곤슬레이어',
    price: 4895376,
    amount: 4,
    created_at: 1763917681957,
  },
  {
    id: '3',
    item_key: 'cloth_armor',
    type: 'buy',
    listed_by: '포션중독자',
    price: 1548,
    amount: 23,
    created_at: 1763917501957,
  },
  {
    id: '2',
    item_key: 'mp_potion',
    type: 'sell',
    listed_by: '어둠의추적자',
    price: 2331360,
    amount: 5,
    created_at: 1763917321957,
  },
  {
    id: '1',
    item_key: 'stone_sword',
    type: 'buy',
    listed_by: '모험왕',
    price: 623,
    amount: 43,
    created_at: 1763917141957,
  },
]

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  try {
    const { page, name, category, grade, type } = req.query as {
      page?: string
    } & FilterParams

    // page는 필수
    if (!page || isNaN(Number(page))) {
      return res.status(400).json({
        code: 'BAD_REQUEST',
        message: '`page` 파라미터는 필수이며 숫자여야 합니다.',
        data: null,
      })
    }

    const pageNum = Number(page)
    const PAGE_SIZE = 20

    // 최신순 정렬
    let filtered = [...MOCK_PRODUCTS].sort(
      (a, b) => b.created_at - a.created_at,
    )

    // ---- ⭐ 필터링 로직 ----
    filtered = filtered.filter(product => {
      const meta = ITEM_DATABASE[product.item_key as keyof typeof ITEM_DATABASE]

      if (!meta) return false

      if (name && !meta.name.includes(name)) return false
      if (category && meta.category !== category) return false
      if (grade && meta.grade !== grade) return false
      if (type && product.type !== type) return false

      return true
    })

    // ---- ⭐ 페이지네이션 ----
    const start = (pageNum - 1) * PAGE_SIZE
    const end = start + PAGE_SIZE
    const paginated = filtered.slice(start, end)

    res.status(200).json({
      code: 'SUCCESS',
      message: '상품 목록 조회 성공',
      data: {
        totalPages: Math.ceil(filtered.length / PAGE_SIZE),
        products: paginated,
        page: pageNum,
      },
    })
  } catch (e) {
    console.error(e)
    res.status(500).json({
      code: 'INTERNAL_SERVER_ERROR',
      message: '내부 서버 오류가 발생했습니다.',
      data: null,
    })
  }
}
